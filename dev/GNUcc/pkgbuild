Name="GNU Cross Compiler"
Vendor="GNU Project"
Description="GCC is a compiler used to build programs, kernels, GNU Toolchain and your own software you write in C or something like that"
Version="11.2.0"
Archive_name="gcc-.$Version.tar.xz"
Depends_on=("base/mpc", "base/gmp", "base/mpfr")
Maintainer="Marco Tulio DueÃ±as"
Hotline="marcot.dns@gmail.com"

Destdir="/usr/tmp/fuba-$Version"

unarchive() {
	c -cd "$Archive_name" | tar -xvf - -C "$OBJDIR"
}

configure() {

	# Regenerating limits.h
	LIBGCC_PATH=$(dirname $(${COPA_TARGET}-gcc -print-libgcc-file-name))
	cat gcc/limitx.h gcc/glimits.h gcc/limity.h \
		> $LIBGCC_PATH/include-fixed/limits.h


	ln -s gmp-6.2.1 gmp	\
		&& ln -s mpc-1.2.1 mpc	\
		&& ln -s mpfr-4.1.0 mpfr	\
		&& mkdir build	\
		&& cd build
		CFLAGS='-g0 -O0'	\
		CXXFLAGS=$CFLAGS	\
		sh ../configure	\
		--target=${COPA_TARGET}	\
		--build=${COPA_HOST}	\
		--host=${COPA_TARGET}	\
		--prefix=/tools	\
		--with-local-prefix=/tools	\
		--with-native-system-header-dir=/tools/include	\
		--enable-languages=c,c++	\
		--disable-libstdcxx-pch	\
		--disable-multilib	\
		--disable-bootstrap	\
		--disable-libgomp	\
		--disable-libquadmath	\
		--disable-libssp	\
		--disable-libvtv	\
		--disable-symvers	\
		--disable-libitm	\
		--disable-libsanitizer
}

post_install() { 
	find $LIBGCC_PATH/include/* -maxdepth 0 -xtype d -exec rm -rf '{}' \; \
	&& rm -f $(grep -l 'DO NOT EDIT THIS FILE' $LIBGCC_PATH/include/*)
	return 0; 
}

build() {
	gmake -j$(grep -c 'processor' /proc/cpuinfo) PATH='/bin:/usr/bin:/cross-tools/bin:/tools/bin' \
	&& gmake install
}
